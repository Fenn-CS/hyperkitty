{% load url from future %}
{% load hk_generic %}

    {% if user.is_authenticated %}
    <a class="reply" href="#">Reply</a>
    <div class="reply-form dropdown">
        <form method="post" enctype="multipart/form-data"
              action="{% url 'message_reply' mlist_fqdn=mlist_fqdn message_id_hash=message_id_hash %}">
            {% csrf_token %}
            <ul class="reply-tools">
                <li><a class="btn btn-mini quote" href="#">Quote</a></li>
                <li><label>{{ reply_form.newthread }} Create a new thread</label></li>
                <li><a class="reply-mailto"
                   href="mailto:{{ mlist.name }}?Subject={{ email.subject|reply_subject|urlencode }}&amp;In-Reply-To={{ email.message_id|urlencode }}"
                   >Use email software</a></li>
            </ul>
            {{ reply_form.non_field_errors }}
            {% for field in reply_form %}
                {% if field.html_name != "newthread" %}
                    <p>{{ field }} {{ field.errors}}</p>
                {% endif %}
            {% endfor %}
            {# { reply_form.as_p } #}
            <p class="buttons">
                <button type="submit" class="submit btn btn-primary">Send</button>
                or <a class="cancel" href="#">cancel</a>
            </p>
        </form>
    </div>
    {% else %}
    <a class="reply reply-mailto" title="Login to reply online"
       href="mailto:{{ mlist.name }}?Subject={{ email.subject|reply_subject|urlencode }}&amp;In-Reply-To={{ email.message_id|urlencode }}"
       >Reply</a>
    {% endif %}
